---
layout: mypost
title: Vue2基础拾遗
categories: [Vue]
---

## 数据代理

Vue 首先将 data 中的数据存储在实例对象 vm 的 \_data 中，然后利用`Object.defineProperty()`把 \_data 中的所有属性添加到 vm 身上，并为每个属性分别创建 getter 和 setter，在 getter 和 setter 内部代理操作 \_data 中对应的属性，实现数据代理。![01](01.png)

## 列表渲染

```html
<ul id="root">
  <!-- <li v-for="(p, index) in persons" :key="index"> -->
  <li v-for="p in persons" :key="p.id">{{p.name}}--{{p.age}}</li>
</ul>
```

```js
new Vue({
  el: "#root",
  data: {
    persons: [
      { id: "01", name: "Leon", age: 18 },
      { id: "02", name: "Jack", age: 23 },
      { id: "03", name: "Tim", age: 15 },
    ],
  },
});
```

v-for 指令可以遍历对象、数组、字符串、指定次数。但常用的仅对象和数组。

## key 的原理

key 可以省略，可以值为 index，也可以值为数据中的 id。

key 的存在与 Vue 的虚拟 DOM 有关。

### 虚拟 DOM 中 key 的作用

key 是虚拟 DOM 中对象的标识，当数据发生变化时，Vue 会根据新数据生成新的虚拟 DOM。随后 Vue 根据新的虚拟 DOM 与旧的虚拟 DOM，进行 Diff 算法比较差异。比较规则如下：

旧虚拟 DOM 中找到了与新虚拟 DOM 相同的 key：

- 若虚拟 DOM 中内容没变, 则直接使用之前的真实 DOM
- 若虚拟 DOM 中内容变了, 则生成新的真实 DOM，随后替换掉页面中之前的真实 DOM

旧虚拟 DOM 中未找到与新虚拟 DOM 相同的 key：创建新的真实 DOM，随后渲染到到页面

### 用 index 作为 key 可能会引发的问题

若对数据进行逆序添加、逆序删除等破坏顺序操作：则会产生没有必要的真实 DOM 更新。虽然界面效果没问题，但效率低。

若结构中还包含输入类的 DOM：则会产生错误 DOM 更新。界面有问题。

### 开发中如何选择 key

最好使用每条数据的唯一标识作为 key，比如 id、手机号、身份证号、学号等唯一值。

当然，如果确认不存在对数据的逆序添加、逆序删除等破坏顺序操作，结构中也不存在输入类 DOM，仅用于渲染列表用于展示，则使用 index 作为 key 也是没有问题的。

## 列表过滤
